<!DOCTYPE html>
<html lang="pt-br" xmlns:th="https://www.thymeleaf.org">

<head th:replace="fragmentos/fragmento :: head"></head>
<style>
	* {
		box-sizing: border-box;
		margin: 0;
		padding: 0;
		font-family: Arial, sans-serif;
	}

	body {
		display: flex;
		justify-content: center;
		align-items: center;
		height: 100vh;
		background-color: #f5f5f5;
	}

	.container {
		display: flex;
		width: 100%;
		background-color: white;
		box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
		padding: 20px;
	}

	.venta-container {
		flex: 3;
		margin-right: 20px;
	}

	.codigo-input {
		width: 100%;
		padding: 10px;
		margin-bottom: 20px;
		border: 2px solid #f3d6f0;
		border-radius: 5px;
	}

	.productos-table {
		width: 100%;
		border-collapse: collapse;
	}

	.productos-table th,
	.productos-table td {
		padding: 10px;
		text-align: center;
		border: 1px solid #ddd;
	}

	.delete-btn {
		background: none;
		border: none;
		font-size: 18px;
		cursor: pointer;
		color: red;
	}

	.resumen-container {
		flex: 1;
		background-color: #f8f8f8;
		padding: 20px;
		border-radius: 5px;
		display: flex;
		flex-direction: column;
		justify-content: space-between;
	}

	.buscar-cliente input,
	.nombre-telefono input {
		width: 100%;
		padding: 10px;
		margin-bottom: 10px;
		border: 1px solid #ccc;
		border-radius: 5px;
	}

	.total {
		font-size: 24px;
		display: flex;
		justify-content: space-between;
		margin-bottom: 20px;
	}

	.btn-completar {
		padding: 15px;
		background-color: #7bd434;
		color: white;
		font-size: 16px;
		border: none;
		border-radius: 5px;
		cursor: pointer;
	}
</style>
</style>

<body>
	<!-- Pre-loader start -->
	<div th:replace="fragmentos/fragmento :: preloader"></div>
	<!-- Pre-loader end -->

	<!-- INICIO DO CORPO DO PROGRAMA-->
	<div id="main-wrapper" data-navbarbg="skin6" data-theme="light" data-layout="vertical" data-sidebartype="full"
		data-boxed-layout="full">

		<header th:replace="fragmentos/fragmento :: CABECALHO"></header>

		<!-- ============================================================== -->
		<aside th:replace="fragmentos/fragmento :: ASSIDE"></aside>

		<div class="page-wrapper">
			<div th:replace="fragmentos/fragmento :: DASHBOARD">

			</div>

			<!-- ========================== AS INFORMAÇÕES DEVE SER COLOCADA AQUI==================================== -->
			<div class="container-fluid" th:fragment="INFORMACAOAQUI">
				<!-- Ravenue - page-view-bounce rate -->
				<!-- ============================================================== -->
				<a class="btn btn-primary btn-md col-12" th:href="@{/stl/produtos/cadastrar}">CADASTRAR
					PRODUTO</a>
				<br><br>

				<div class="container">
					<!-- Seção da Venda -->
					<div class="venta-container">
						<form id="formPesquisarProduto" th:action="@{/stl/vendas/pesquisar}" method="post">
							<input type="text" class="codigo-input" name="codigo" id="codigoInput"
								placeholder="Digite o código de barras e pressione enter">
						</form>

						<table class="productos-table">
							<thead>
								<tr>
									<th>#</th>
									<th>Código</th>
									<th>Nome</th>
									<th>Preço</th>
									<th>QTD</th>
									<th>Total</th>
									<th></th>
								</tr>
							</thead>
							<tbody id="tabelaProdutos">
								<tr th:each="produto : ${produtos}">
									<td th:text="${produto.codigoBarra}"></td>
									<td th:text="${produto.nome}"></td>
									<td class="preco" th:text="${#numbers.formatDecimal(produto.preco, 2, 3)} +' kz'">
									</td>
									<td><input type="number" class="qtd-input" min="1" value="1"
											oninput="calcularTotal(this)"></td>
									<td class="total" th:text="${#numbers.formatDecimal(produto.preco, 2, 3)} + ' Kz'">
									</td>
									<td><button type="button" class="btn-remove"
											onclick="removerProduto(this)">Remover</button></td>
								</tr>
							</tbody>
						</table>
						<br /><br />

						<form th:action="@{/stl/vendas/salvar}" th:object="${venda}" method="post">
							<div class="form-row">
								<div class="form-group col-md-3">
									<span>Forma de Pagamento</span>
									<select name="formaPagemento" class="custom-select">
										<option value="Dinheiro">Dinheiro</option>
										<option value="Cartão">Cartão</option>
									</select>
								</div>
								<div class="form-group col-md-3">
									<span>Valor Pago</span>
									<input type="number" name="valorPago" class="form-control" value="0" min="0"
										id="valorPagoInput" oninput="calcularTroco()">
								</div>
								<div class="form-group col-md-3">
									<span>Desconto (%)</span>
									<input type="number" name="desconto" class="form-control" value="0" min="0"
										max="100" id="descontoInput" oninput="atualizarTotalGeral()">
								</div>
							</div>
					</div>

					<!-- Seção do Resumo -->
					<div class="resumen-container">
						<div class="total">
							<span>Troco</span>
							<span class="monto-total" id="troco" name="troco">0 Kz</span>
						</div>
						<div class="total">
							<span>Total a pagar</span>
							<span class="monto-total" id="totalVenda" name="totalVenda">0 Kz</span>
						</div>
						<button class="btn-completar" id="completarVenda" type="submit">COMPLETAR VENDA</button>
					</div>
				</div>


			</div>
			</form>
			<!-- ========================== FIM AS INFORMAÇÕES DEVE SER COLOCADA AQUI==================================== -->


			<div th:replace="fragmentos/fragmento :: RODAPE"></div>
		</div>

	</div>
	<!--FIM DO CORPO DO PROGAMA-->




	<div th:replace="fragmentos/fragmento :: LinkJs"></div>
	<script>
		// Função para calcular o total por produto (quantidade * preço)
		function calcularTotal(element) {
			let row = element.closest('tr');
			let preco = parseFloat(row.querySelector('.preco').innerText.replace(' kz', ''));
			let qtd = parseFloat(element.value);
			let total = preco * qtd;

			row.querySelector('.total').innerText = total.toFixed(2) + ' Kz';
			atualizarTotalGeral();
		}

		// Função para atualizar o total geral da venda, considerando o desconto
		function atualizarTotalGeral() {
			let totalVenda = 0;
			let desconto = parseFloat(document.getElementById('descontoInput').value) || 0;

			document.querySelectorAll('.total').forEach(function (totalCell) {
				totalVenda += parseFloat(totalCell.innerText.replace(' Kz', ''));
			});

			let valorComDesconto = totalVenda - (desconto / 100) * totalVenda;
			document.getElementById('totalVenda').innerText = valorComDesconto.toFixed(2) + ' Kz';
			calcularTroco();
		}

		// Função para calcular o troco
		function calcularTroco() {
			let valorPago = parseFloat(document.getElementById('valorPagoInput').value) || 0;
			let totalVenda = parseFloat(document.getElementById('totalVenda').innerText.replace(' Kz', '')) || 0;
			let troco = valorPago - totalVenda;

			document.getElementById('troco').innerText = troco.toFixed(2) + ' Kz';
		}

		// Função para remover um produto da lista
		function removerProduto(button) {
			let row = button.closest('tr');
			row.remove();
			atualizarTotalGeral();
		}
	</script>
</body>

</html>